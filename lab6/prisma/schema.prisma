generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model address {
  id          Int      @id @default(autoincrement())
  user_id     Int
  country     String   @db.VarChar(100)
  city        String   @db.VarChar(100)
  street_line String   @db.VarChar(255)
  zip_code    String   @db.VarChar(20)
  is_default  Boolean? @default(false)
  users       users    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model administrator {
  id           Int     @id @default(autoincrement())
  user_id      Int     @unique
  full_name    String? @db.VarChar(255)
  access_level String? @db.VarChar(50)
  users        users   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model buyer {
  id         Int      @id @default(autoincrement())
  user_id    Int      @unique
  first_name String?  @db.VarChar(100)
  last_name  String?  @db.VarChar(100)
  phone      String?  @db.VarChar(20)
  users      users    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders     orders[]
  review     review[]
}

model category {
  id             Int        @id @default(autoincrement())
  name           String     @db.VarChar(255)
  parent_id      Int?
  category       category?  @relation("categoryTocategory", fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_category category[] @relation("categoryTocategory")
  product        product[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model order_item {
  id                Int     @id @default(autoincrement())
  order_id          Int
  product_id        Int
  quantity          Int
  price_at_purchase Decimal @db.Decimal(10, 2)
  orders            orders  @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  product           product @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model orders {
  id           Int          @id @default(autoincrement())
  buyer_id     Int
  total_amount Decimal      @db.Decimal(12, 2)
  status       String?      @default("PENDING") @db.VarChar(50)
  created_at   DateTime?    @default(now()) @db.Timestamp(6)
  order_item   order_item[]
  buyer        buyer        @relation(fields: [buyer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  payment      payment[]
  shipment     shipment?
}

model payment {
  id         Int       @id @default(autoincrement())
  order_id   Int
  amount     Decimal   @db.Decimal(12, 2)
  status     String?   @default("PENDING") @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  orders     orders    @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model product {

  inStock Boolean @default(true)

  id                    Int                     @id @default(autoincrement())
  seller_id             Int
  category_id           Int
  name                  String                  @db.VarChar(255)
  price                 Decimal                 @db.Decimal(10, 2)
  stock_quantity        Int?                    @default(0)
  sku                   String?                 @unique @db.VarChar(100)
  is_active             Boolean?                @default(true)
  version               Int?                    @default(1)
  deleted_at            DateTime?               @db.Timestamp(6)
  order_item            order_item[]
  category              category                @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  seller                seller                  @relation(fields: [seller_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  product_price_history product_price_history[]
  review                review[]
}

model product_price_history {
  id         Int       @id @default(autoincrement())
  product_id Int
  price      Decimal   @db.Decimal(10, 2)
  changed_at DateTime? @default(now()) @db.Timestamp(6)
  product    product   @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model review {
  id         Int       @id @default(autoincrement())
  product_id Int
  buyer_id   Int
  rating     Int?
  comment    String?
  created_at DateTime? @default(now()) @db.Timestamp(6)
  buyer      buyer     @relation(fields: [buyer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  product    product   @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model seller {
  id          Int       @id @default(autoincrement())
  user_id     Int       @unique
  store_name  String    @db.VarChar(255)
  tax_id      String    @unique @db.VarChar(50)
  iban        String    @db.VarChar(50)
  is_verified Boolean?  @default(false)
  product     product[]
  users       users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model shipment {
  id              Int     @id @default(autoincrement())
  order_id        Int     @unique
  country         String? @db.VarChar(100)
  city            String? @db.VarChar(100)
  street_line     String? @db.VarChar(255)
  zip_code        String? @db.VarChar(20)
  tracking_number String? @db.VarChar(100)
  status          String? @default("PENDING") @db.VarChar(50)
  orders          orders  @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model users {
  id            Int            @id @default(autoincrement())
  email         String         @unique @db.VarChar(255)
  password_hash String         @db.VarChar(255)
  created_at    DateTime?      @default(now()) @db.Timestamp(6)
  deleted_at    DateTime?      @db.Timestamp(6)
  address       address[]
  administrator administrator?
  buyer         buyer?
  seller        seller?
}

model Ticket {
  id        Int      @id @default(autoincrement())
  title     String
  message   String
  createdAt DateTime @default(now())
}